<h1>Listing Movies</h1>


<%= form_tag set_genres_movies_path do %>
<% if can? :set_genres, Movie %>
  <%= select_tag 'genres_ids[]', options_from_collection_for_select(@genres, 'id', 'name'), prompt: "Seleciona el/los generos", multiple: true %>

  <%= submit_tag "Guardar" %>

<% end %>
  <table>
    <thead>
      <tr>
      <% if can? :set_genres, Movie %>
        <th colspan="2">Title</th>
      <% else %>
        <th>Title</th>
      <% end %>
        <th>Genres</th>
        <th>Realease date</th>
        <th>Studio</th>
        <th colspan="3"></th>
      </tr>
    </thead>

    <tbody>
      <% @movies.each do |movie| %>
        <tr>
          <% if can? :set_genres, Movie %>
            <td><%= check_box_tag 'movies_ids[]', movie.id %></td>
          <% end %>
          <td><%= movie.title %></td>
          <td><%= movie.genres.join(', ') %></td>
          <td><%= time_tag movie.realease_date, movie.realease_date.strftime('%Y') %></td>
          <td><%= movie.studio %></td>
          <td><%= link_to t(:show), movie %></td>
          <% if can? :edit, movie %>
            <td><%= link_to t(:edit), edit_movie_path(movie) %></td>
          <% end %>
          <% if can? :destroy, movie %>
            <td><%= link_to t(:destroy), movie, method: :delete, data: { confirm: t(:confirmation) } %></td>
          <% end %>
        </tr>
      <% end %>
    </tbody>
  </table>
<% end %>
<br>

<%= link_to t(:new), new_movie_path if can? :create, Movie %>
